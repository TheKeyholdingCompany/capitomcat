<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Capitomcat by sunggun-yu</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Capitomcat</h1>
        <p>Capistrano Recipe for Tomcat Deploy</p>
        <p class="view"><a href="https://github.com/sunggun-yu/capitomcat">View the Project on GitHub <small>sunggun-yu/capitomcat</small></a></p>
        <ul>
          <li><a href="https://github.com/sunggun-yu/capitomcat/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/sunggun-yu/capitomcat/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/sunggun-yu/capitomcat">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="capitomcat" class="anchor" href="#capitomcat"><span class="octicon octicon-link"></span></a>Capitomcat</h1>

<p><a href="http://badge.fury.io/rb/capitomcat"><img src="https://badge.fury.io/rb/capitomcat.png" alt="Gem Version"></a></p>

<p>Capitomcat is library for creating Capistrano Tomcat recipe.
Capitomcat includes basic tasks for Tomcat deployment. You can create easily your own Capistrano 3 recipe for Tomcat with Capitomcat.</p>

<h2>
<a name="requirement" class="anchor" href="#requirement"><span class="octicon octicon-link"></span></a>Requirement</h2>

<h3>
<a name="gem-dependency" class="anchor" href="#gem-dependency"><span class="octicon octicon-link"></span></a>Gem Dependency</h3>

<ul>
<li>Ruby &gt;= 1.9</li>
<li>Capistrano &gt;= 3.0.1</li>
</ul><h3>
<a name="authentication--authorisation-setting-for-remote-servers" class="anchor" href="#authentication--authorisation-setting-for-remote-servers"><span class="octicon octicon-link"></span></a>Authentication &amp; Authorisation setting for Remote Servers</h3>

<p>By the recommendation of Capistrano 3, Capitomcat use SSH Key and NOPASSWD instead of asking password.</p>

<p>for more details, please refer to  <a href="http://capistranorb.com/documentation/getting-started/authentication-and-authorisation/">Authentication &amp; Authorisation</a> page on Capistrano website.</p>

<h4>
<a name="user-account-setting" class="anchor" href="#user-account-setting"><span class="octicon octicon-link"></span></a>User account setting</h4>

<div class="highlight highlight-sh"><pre>root@remote <span class="nv">$ </span>adduser &lt;your_deploy_user_name&gt;
root@remote <span class="nv">$ </span>passwd -l &lt;your_deploy_user_name&gt;
</pre></div>

<p>or</p>

<div class="highlight highlight-sh"><pre>root@remote <span class="nv">$ </span>adduser --home /home/deploy --disabled-password deploy
</pre></div>

<h4>
<a name="ssh-key-setting" class="anchor" href="#ssh-key-setting"><span class="octicon octicon-link"></span></a>SSH Key setting</h4>

<p>Add your SSH key into <code>authorized_keys</code> file of <code>deploy</code> user on your remote server.</p>

<h4>
<a name="nopasswd-setting-for-sudo" class="anchor" href="#nopasswd-setting-for-sudo"><span class="octicon octicon-link"></span></a>NOPASSWD Setting for SUDO</h4>

<p>Folowing NOPASSWD setting is required. please add following setting into your <code>/etc/sudoers</code> file.</p>

<div class="highlight highlight-sh"><pre>%your_deploy_user_name <span class="nv">ALL</span><span class="o">=</span>NOPASSWD:/etc/init.d/tomcat7 &lt;Your tomcat <span class="nb">command</span>&gt;
%your_deploy_user_name <span class="nv">ALL</span><span class="o">=</span>NOPASSWD: /bin/chown 
%your_deploy_user_name <span class="nv">ALL</span><span class="o">=(</span>&lt;your_tomcat_user&gt; : &lt;your_tomcat_user_group&gt;<span class="o">)</span> NOPASSWD: ALL
</pre></div>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>To use Capitomcat in your Capistrano script, you need install as RubyGem</p>

<h3>
<a name="install-ruby" class="anchor" href="#install-ruby"><span class="octicon octicon-link"></span></a>Install Ruby</h3>

<p>Please refer to <a href="http://www.ruby-lang.org/en/downloads/">Download Ruby</a> page on the Ruby official website.</p>

<h3>
<a name="install-rubygems" class="anchor" href="#install-rubygems"><span class="octicon octicon-link"></span></a>Install RubyGems</h3>

<p>Please refer to <a href="http://rubygems.org/pages/download">Download RubyGems</a> page on the RubyGems official website.</p>

<h3>
<a name="install-capistrano" class="anchor" href="#install-capistrano"><span class="octicon octicon-link"></span></a>Install Capistrano</h3>

<p>Capitomcat v1.0.0 supports Capistrano 3. (Capitomcat v0.0.x supports Capistrano 2)</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install capistrano -v 3.0.1
</pre></div>

<h3>
<a name="install-capitomcat" class="anchor" href="#install-capitomcat"><span class="octicon octicon-link"></span></a>Install Capitomcat</h3>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install capitomcat
</pre></div>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<h3>
<a name="role-configuration" class="anchor" href="#role-configuration"><span class="octicon octicon-link"></span></a>Role Configuration</h3>

<pre>
role :app, %w{deploy@dev01 deploy@dev02}
</pre>

<h3>
<a name="required-configuration-for-capitomcat" class="anchor" href="#required-configuration-for-capitomcat"><span class="octicon octicon-link"></span></a>Required configuration for Capitomcat</h3>

<pre>
set :use_sudo, true

# Remote Tomcat server setting section
set :tomcat_user, 'tomcat7'
set :tomcat_user_group, 'tomcat7'
set :tomcat_port, '8080'
set :tomcat_cmd, '/etc/init.d/tomcat7'
set :use_tomcat_user_cmd, false
set :tomcat_war_file, '/var/app/war/test-web.war'
set :tomcat_context_path, '/test-web'
set :tomcat_context_file, '/var/lib/tomcat7/conf/Catalina/localhost/test-web.xml'
set :tomcat_work_dir, '/var/lib/tomcat7/work/Catalina/localhost/test-web'

# Deploy setting section
set :local_war_file, '/tmp/test-web.war'
set :context_template_file, File.expand_path('../templates/context.xml.erb', __FILE__).to_s
set :use_context_update, false
set :use_parallel, false
set :use_context_update, false
</pre>

<h3>
<a name="task" class="anchor" href="#task"><span class="octicon octicon-link"></span></a>Task</h3>

<p>You can get task name of Capitomcat by run <code>cap -T</code></p>

<pre>
cap capitomcat:deploy              # Capitomcat Recipe for Tomcat web application deployment
</pre>

<h3>
<a name="documentation-is-still-working-on" class="anchor" href="#documentation-is-still-working-on"><span class="octicon octicon-link"></span></a><strong><em>Documentation is still working on...</em></strong>
</h3>

<p>♥For more details, please refer to example recipes.♥</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<pre>
Copyright 2014 Sunggun Yu

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</pre>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/sunggun-yu">sunggun-yu</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>